---
title: "Introducci칩n al an치lisis estad칤stico"
subtitle: "Teor칤a de probabilidad y Modelamiento estad칤stico"
author: "Daniel Jim칠nez M."
date: "`r format(Sys.time(), '%d -%m -%Y')`"
institute: "Universidad Nacional de Colombia"
output: 
  beamer_presentation:
    theme: "Madrid"
    colortheme: "beaver"
    #incremental: true
    slide_level: 2
    latex_engine: xelatex
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE)
```




## Distribuci칩n Binomial

Es una distribuci칩n de probabilidad  que estudia entre el n칰mero de repeticiones `n` de un evento hasta llegar a comprender el n칰mero de exitos obtenidos. Los valores de este tipo de distriuci칩n estan entre 0 y 1.

Ya que ustedes son Muchachos de poca fe, ac치 les muestro la formula

$$
f(x)=\binom{n}{x}p^{x}(1-p)^{(n-x)}
$$




## Distribuci칩n Binomial


```{r, echo=FALSE, cache=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
theme_set(theme_classic())
```
Analicemos el siguiente problema: Suponga que esta haciendo un examen con 20 preguntas, cada pregunta tiene cuatro posibles respuestas y solo una de ellas es la correcta. Encuentre la probabilidad de que al menos ocho respuestas sean las correctas.

Tenga presente que : $1/4=0.25$ es la probabilidad que una respuesta sea la correcta.

```{r}
pbinom(8,size = 20,prob = 1/4)
```

La probabilidad de que responda al menos ocho preguntas de manera correcta es del 95%.

## Distribuci칩n Binomial

Las propiedades de esta distribuci칩n son las siguientes:

* $E(X)$ = $np$

* $Var(X)$=$np(1-p$

* $m_x(t)$=$(pe^{t}+1-p)^{n}$


## Distribuci칩n Binomial

El comportamiento de una variable binomial es el siguiente

```{r, echo=FALSE, fig.height=3}
n<-100000
ma.bimon<-rbinom(n,size = 10,prob = .7)
qplot(ma.bimon,geom = 'histogram')+
  labs(title = 'Forma de la distribuci칩n Binomial en el histograma',
       subtitle = 'Probabilidad E(X)=0.7')
```





## Distribuci칩n Binomial

El comportamiento de los datos pareados es el siguiente


```{r, echo=FALSE, fig.height=3}
n<-100000
ma.bimon<-rbinom(n,size = 10,prob = .7)
x1<-ma.bimon[-n]
x2<-ma.bimon[-1]
qplot(x1,x2)+
  labs(title = "Pairwise de la distribuci칩n Binomial",
       subtitle = "Probabilidad centrada en 0.7")
```

## Distribuci칩n Binomial


La funci칩n de Autocorrelaci칩n (Esto es super 칰til cuando quiere hacer forecasting) tiene el siguiente comportamiento


```{r, fig.height=3}
acf(ma.bimon)
```



## Distribuci칩n Poisson


Estudia el n칰mero de ocurrencias de alg칰n evento durante un intervalo de tiempo. Este tipo de aplicaciones es super 칰til cuando quiere calcular la probabilidad de ocurrencia de un evento donde mide la cantidad de individuos o eventos que ocurriran en un momento especifico, como por ejemplo: El n칰mero de personas que atender치 un cajero al medio d칤a.

Matem치ticamente se describe como :

$$
f(x)=\frac{\lambda^{x}e^{-\lambda}}{!x}
$$



## Distribuci칩n Poisson

Suponga que usted tiene **Tinder** 游땓y en promedio en un d칤a hace 12 Match. Calcule la probabilidad de que haga 15 Match en un d칤a.

Se calcular치 la probabilidad como 14 칩 mas Matchs

```{r}
ppois(q = 14,lambda = 12,lower.tail = FALSE)
```



## Distribuci칩n Poisson

Las propiedades de la distribuci칩n de probabilidad es la siguiente

* $E(X)$=$\lambda$

* $Var(X)$=$\Lambda$

* $m_x(t)$=$exp{\lambda(e^{t}-1)}$



## Distribuci칩n Poisson

El comportamiento del histograma es el siguiente

```{r,fig.height=3}
n<-10000
n.pois<-rpois(n,lambda = 5)
qplot(n.pois,geom = "histogram")+
  labs(title = "Histograma de una distribuci칩n Poisson",
       subtitle = "Lambda centrado en 5")
```




## Distribuci칩n Poisson


La funci칩n de autocorrelaci칩n es la siguiente

```{r, fig.height=3}
acf(n.pois)
```

## Distribuci칩n Exponencial

Calcula la probabilidad de ocurrencia de dos eventos en intervalos de tiempo, como por ejemplo, el tiempo que transcurre hasta recibir una llamada.

Matem치ticamente se ve de la siguiente manera:


$$
f(x)=\frac{1}{\theta}e^{{-x/\theta}}I_{(0,\infty)}
$$

## Distribuci칩n Exponencial

Suponga que el tiempo promedio en que un cajero de Juan Valdez vende un producto es de dos minutos. Calcule la probabilidad de que ejecute pagos en al menos 1 minuto.


```{r}
pexp(1,rate = 1/2)
```

## Distribuci칩n Exponencial

Las propiedades de esta distribuci칩n son:

* $E(X)$=$\theta$

* $Var(X)$=$\theta^2$

* $m_x(t)$=$\frac{1}{1-\theta t}$

**Dato curioso:** Notes칠 que la varianza te칩rica de la distribuci칩n es el cuadrado de la esperanza, por lo tanto a un conjunto de datos continuos mayores a cero, cuando la varianza tiende a parecerse a la esperanza de los valores, podremos decir que esta es una exponencial.


## Distribuci칩n Exponencial

El histograma de la exponencial tiene el siguiente comportamiento


```{r, eval=FALSE}
n<-10000
ma.exp<-rexp(n,rate = 1)
qplot(ma.exp,geom="histogram")+
  labs(title = "Histograma de la Exponencial",
       subtitle = "con rate centrado en 1")
```

## Distribuci칩n Exponencial


```{r, echo=FALSE}
n<-10000
ma.exp<-rexp(n,rate = 1)
qplot(ma.exp,geom="histogram")+
  labs(title = "Histograma de la Exponencial",
       subtitle = "con rate centrado en 1")
```

## Distribuci칩n Exponencial

Una particularidad importante es densidad emp칤rica que consiste en la forma de la distribuci칩n como se da a nivel matem치tico versus su realidad.


```{r, eval=FALSE}
h<-data.frame(x=ma.exp)
h%>%
  ggplot(aes(x))+
  geom_density()+
  stat_function(fun = dexp,geom = "line",col="blue")+
  labs(title = "Distribuci칩n emp칤rica(azul) versus la real(negra)")

```

## Distribuci칩n Exponencial


```{r, echo=FALSE}
h<-data.frame(x=ma.exp)
h%>%
  ggplot(aes(x))+
  geom_density()+
  stat_function(fun = dexp,geom = "line",col="blue")+
  labs(title = "Distribuci칩n emp칤rica(azul) versus la real(negra)")
```


## Distribuci칩n Exponencial

```{r, fig.height=3}
acf(ma.exp)
```

## Prueba Kolmogorov - Smirnov

Imagines칠 que quiere comprobar si una distribuci칩n proviene de una familia estad칤stica especifica, par comprobarlo debe usar una prueba de hip칩tesis

* $H_0:$ Los datos provienen de una distribuci칩n espec칤fica
* $H_1:$ Los datos no provienen de dicha distribuci칩n

Ahora viene el mejor amigo de todos, el p-value: si este es menor que $\alpha$, cuando $\alpha=0.05$, entonces se rechaza la hip칩tesis nula.

## Prueba Kolmogorov - Smirnov

```{r}
ks.test(ma.exp,"pexp",rate=1)
```


Se acepta la distribuci칩n exponencial.


## Distribuci칩n Normal

Tambi칠n se le conoce como distribuci칩n gaussiana, es la m치s utilizada en teor칤a estad칤stica gracias a su amplitud de aplicaciones en temas sociales, naturales y en psicolog칤a. El poder de esta distribuci칩n radica que asume eventos incontrolables como independientes en cada una de sus observaciones.

Matem치ticamente se describe de la siguiente manera:

$$
f(x)=\frac{1}{\sigma \sqrt(2\pi)}e^{\frac{-(x-\mu)^2}{2\sigma^2}}
$$



## Distribuci칩n Normal


Suponga que el ranking para adquirir un prestamos de vivienda debe ser de 80 (promedio) puntos, la desviaci칩n del mismo esta en 30. 쮺칰al es la probabilidad de que personas que accedan al cr칠dito este por encima de 90?


```{r}
pnorm(90,mean = 80,sd = 30,lower.tail = FALSE)
```



## Distribuci칩n Normal


Las propiedades de la normal son :

* $E(X)$=$\mu$

* $Var(X)$=$\sigma^2$

* $m_x(t)$=$exp\{\mu t+\frac{1}{2}\sigma^2t^2\}$


## Distribuci칩n Normal

El histograma de la normal es el siguiente :

```{r, eval=FALSE}
ma.norm<-rnorm(10000,mean = 12,sd = 6)
qplot(ma.norm,geom = "histogram")+
  labs(title = "Forma de la distribuci칩n Normal",
       subtitle = "Con promedio en 12 y desviaci칩n en 6")
```

## Distribuci칩n Normal

```{r, echo=FALSE,fig.height=3}
ma.norm<-rnorm(10000,mean = 12,sd = 6)
qplot(ma.norm,geom = "histogram")+
  labs(title = "Forma de la distribuci칩n Normal",
       subtitle = "Con promedio en 12 y desviaci칩n en 6")
```


## Distribuci칩n Normal

La funci칩n de autocorrelaci칩n es la siguiente :


```{r, fig.height=3}
acf(ma.norm)
```


## Distribuci칩n Weibull

Es conocida tambi칠n como an치lisis de sobrevivencia, ya que estudia el tiempo transcurrido hasta que llegue un evento de fallecimiento o falla de un fen칩meno estudiado.

Matem치ticamente se describe como:

$$
f(x)=\frac{k}{\theta^k}x^{(k-1)}exp\{-\frac{x^k}{\theta^k}\}I_{(0,\infty)}
$$


## Distribuci칩n Weibull

Las propiedades de la Weibull son :

* $E(X)$=$\theta T(1+\frac{1}{k})$

* $Var(X)$=$\theta^2[T(1+\frac{2}{k})-(T(1+\frac{1}{k}))^2]$


## Distribuci칩n Weibull

Las partes de un Computador *Compaq* tiene una duraci칩n de vida $\alpha=4$ y $\beta=3$, 쮺alcule la fiabilidad que no fallen a las .70 horas?

```{r}
pweibull(.70,4,scale = 3^(1/4),lower.tail = FALSE)
```


## Modelamiento Estad칤stico

El modelamiento estad칤stico sirve para:

* Identificar patrones en los datos;
* Clasificar Datos;
* Detectar multiples influencias en los datos;
* Evaluar fuerza de la evidencia de los datos


## Modelamiento Estad칤stico

Algunas definciones necesarias:

* Modelo: Representaci칩n de la realidad;
* Modelo matem치tico: Construcci칩n matem치tica de objetos
* Modelo estad칤stico: Entrenamiento de datos para construir objetos.


## Modelamiento Estad칤stico

* Bases de datos: conjunto de matriz que se caracteriza por tener nombres de variables y valores.



## Modelamiento Estad칤stico

Suponga que quiere averiguar el promedio del sepalo (largo) por especie
```{r}
library(mosaic)
data("iris")# Cargar data
mean(Sepal.Length~Species,data=iris) # Esta es una forma elegante de hacer an치lisis estad칤stico
```


## Modelamiento Estad칤stico

Construyendo un modelo: Suponga que quiere construir un modelo que describa el largo del sepalo, de tal manera que cada variable nueva en el set de datos se pueda calcular. Para ello trabajaremos con la funci칩n `lm`

```{r}
modelo<-lm(Sepal.Length~Species,data=iris)
modelo
```



## Modelamiento Estad칤stico

```{r}
modelo%>%summary()
```

## Modelamiento Estad칤stico

Lo anterior quiere decir 


$$
\mbox{Largo del sepalo }=\mbox{intercepto}(5.006)+(\beta_1 \mbox{ versicolor}*(0.930 )+(\beta_1 \mbox{ virginica }*(1.582))
$$


## Modelamiento Estad칤stico

Una forma practica aunque con falta de rigor para hallar los datos que sirvan para pronosticar el largo del sepalo es con la funci칩n `step` y el criterio de Akaike

```{r}
modelo1<-lm(Sepal.Length~.,data=iris)
step(modelo1,direction = 'both',trace = 1)
```


## Modelamiento Estad칤stico

Para conocer los intervalos de confianza

```{r}
confint(modelo1)
```



## Modelamiento Estad칤stico

Una buena practica para desarrollar modelos estad칤sticos es validar su nivel de correlaci칩n


```{r, fig.height=3}
library(corrplot)
cor(iris[,-5])%>%
  corrplot()
```

## Modelamiento Estad칤stico


Una manera m치s elegante y eficiente de trabajar esto es con la funci칩n `ggpairs`

```{r, eval=FALSE}
library(GGally)
iris%>%
  ggpairs(aes(color=Species))
```

## Modelamiento Estad칤stico

```{r, echo=FALSE}
library(GGally)
iris%>%
  ggpairs(aes(color=Species))
```


## Modelamiento Estad칤stico

Una 칰ltima forma de validar estas relaciones es 

```{r,fig.height=3}
library(psych)
multi.hist(x = iris[,-5], dcol = c("blue", "red"), dlty = c("dotted", "solid"),
           main = "")
```


## Modelamiento Estad칤stico

Pasos para dise침ar un modelo:

* Definir el objetivo;
* Dise침ar un modelo con las variables necesarias;
* Entrenar un modelo;
* Evaluar un modelo;
* Testear el modelo;
* Interpretar el modelo.


## Modelamiento Estad칤stico 

Una forma excelente de entender la arquitectura de un modelo es con `rpart`


```{r}
library(rpart)
library(rpart.plot)
modelo_1<-lm(Sepal.Length~.,data=iris)
modelo_2<-rpart(Sepal.Length~.,data=iris)
```


## Modelamiento Estad칤stico 

```{r}
modelo_1
```

## Modelamiento Estad칤stico 



```{r}
modelo_2
```


## Modelamiento Estad칤stico 

```{r, fig.height=3}
library(rpart.plot)
rpart.plot(modelo_2)
```


## Modelamiento Estad칤stico 

Para calcular nuevos outputs se hace de la siguiente manera

```{r}
new_input<-data.frame("Sepal.Width"=4,"Petal.Length"=1.1,"Petal.Width"=0.4,"Species"="setosa")
predict(modelo_1,newdata = new_input)
```

## Modelamiento Estad칤stico 

A trav칠s del modelo rpart

```{r}
predict(modelo_2,newdata = new_input)
```

## Modelamiento Estad칤stico 

쮺칰al de los modelos es mejor?


```{r}
output1<-iris$Sepal.Length-predict(modelo_1,newdata = new_input)
head(output1)
```

```{r}
output2<-iris$Sepal.Length-predict(modelo_2,newdata = new_input)
head(output2)
```

El que tenga menor error


## Modelamiento Estad칤stico 


La forma correcta de seleccionar un modelo es a trav칠s de un `Mean Square Error`

```{r}
print(mean(output1^2))
print(mean(output2^2))
```

## Modelamiento Estad칤stico 

```{r,fig.height=3}
prp(modelo_2, type = 3,varlen = 0)
```
## Modelamiento Estad칤stico 

Si se quiere detallar mas el modelo


```{r}
modelo_2<-rpart(Sepal.Length~.,data=iris,cp=0.0002)
```



## Modelamiento Estad칤stico 

```{r, fig.height=3}
prp(modelo_2,type=4,varlen = 0)
```


## Modelamiento Estad칤stico 

Para mejorar el performance de un modelo de regresi칩n se puede trabajar el an치lisis de covariantes, en donde variables que no son de interes pueden mejorar el rendimiento de la variable de respuesta


```{r, fig.height=1}
lm(Sepal.Length~Sepal.Width, data = iris)%>%
  summary()
```


